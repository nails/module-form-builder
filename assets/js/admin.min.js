!function(){"use strict";class t{constructor(t,e){this.adminController=t,this.$container=e,this.tplField=$(".js-template-field",this.$container).html(),this.tplOption=$(".js-template-field-option",this.$container).html(),this.fieldsHeader=$(".form-builder__header",this.$container),this.fieldsTable=$(".form-builder__fields",this.$container),this.fieldCount=0,this.types=e.data("field-types"),$(this.$container).on("change",".field-type",(t=>{this.fieldTypeChanged($(t.currentTarget))})).on("click",".js-remove-field",(t=>(this.removeField($(t.currentTarget)),!1))).on("click",".js-add-option",(t=>(this.addOption($(t.currentTarget)),!1))).on("click",".js-manage-option",(t=>(this.manageOptions($(t.currentTarget)),!1))).on("click",".js-remove-option",(t=>(this.removeOption($(t.currentTarget)),!1))),$(".js-add-field",this.$container).on("click",(()=>(this.addField(),!1))),$("td.type .field-type",this.fieldsTable).each(((t,e)=>{$(e).trigger("change")})),this.fieldCount=$("tbody tr",this.fieldsTable).length-1,$(this.fieldsTable).sortable({items:"tbody",handle:".handle",axis:"y",placeholder:"sortable-placeholder",helper:(t,e)=>{let s=e.find("td"),o=e.clone();return o.find("td").each((function(t){$(this).width(s.eq(t).outerWidth())})),o.css({"margin-left":"-1px","box-shadow":"0px 2px 5px rgba(0, 0, 0, 0.25)"}),o},start:function(t,e){e.placeholder.append('<tr><td colspan="8"><div></div></td></tr>'),e.placeholder.find("td").height(e.helper.outerHeight())}})}addField(){let t,e;return this.fieldCount++,this.log("Adding new field"),e={fieldNumber:this.fieldCount},t=Mustache.render(this.tplField,e),$("> tfoot",this.fieldsTable).before(t),$("> tbody",this.fieldsTable).last().find(".select2").select2(),$("> tbody",this.fieldsTable).last().find("td.type .field-type").trigger("change"),this}removeField(t){let e=t.data("field-number");return this.log("Removing field: "+e),t.closest("tbody").remove(),$(".form-field-options-"+e,this.$container).remove(),this}addOption(t){let e,s,o,i,r;return e=t.data("field-number"),o=t.closest("table"),s=o.data("option-count")||0,this.log("Adding Option for field: "+e),this.log("Number of existing options: "+s),r={fieldNumber:e,optionNumber:s},i=Mustache.render(this.tplOption,r),o.find("tbody").append(i),s++,this.log("New option count: "+s),o.data("option-count",s),this}manageOptions(t){let e=t.data("field-number");this.log("Managing options for field: "+e);let s=t.closest("tr").next();return s.hasClass("active")?s.find("td > .form-field-options").stop().slideUp(null,(function(){s.removeClass("active")})):s.addClass("active").find("td > .form-field-options").stop().slideDown(),this}removeOption(t){let e;return e=t.data("field-number"),this.log("Removing option for field: "+e),t.closest("tr").remove(),this}fieldTypeChanged(t){let e=t.val();return this.log("Field slug changed to: "+e),this.doesSupportOptions(e)?(this.log("Supports options; showing"),t.siblings("a").addClass("is-active")):(this.log("Does not support options; hiding"),t.siblings("a").removeClass("is-active"),t.closest("tr").next().removeClass("active")),this.doesSupportOptionSelect(e)?(this.log("Supports option selection; showing"),t.closest("tbody").find("tr.options table").addClass("is-selectable")):(this.log("Does not support option selection; hiding"),t.closest("tbody").find("tr.options table").removeClass("is-selectable"),t.closest("tbody").find("tr.options .option-selected").prop("checked",!1)),this.doesSupportOptionDisable(e)?(this.log("Supports option disabling; showing"),t.closest("tbody").find("tr.options table").addClass("is-disableable")):(this.log("Does not support option disabling; hiding"),t.closest("tbody").find("tr.options table").removeClass("is-disableable"),t.closest("tbody").find("tr.options .option-disabled").prop("checked",!1)),this.doesSupportDefaultValue(e)?(this.log("Supports default value; showing"),t.closest("tr").find("td.default .js-supports-default-value").show(),t.closest("tr").find("td.default .js-no-default-value").hide()):(this.log("Does not support default value; hiding"),t.closest("tr").find("td.default .js-supports-default-value").hide(),t.closest("tr").find("td.default .js-no-default-value").show()),this.doesSupportPlaceholder(e)?(this.log("Supports placeholder; showing"),t.closest("tr").find("td.field-placeholder .js-supports-placeholder").show(),t.closest("tr").find("td.field-placeholder .js-no-placeholder").hide()):(this.log("Does not support placeholder; hiding"),t.closest("tr").find("td.field-placeholder .js-supports-placeholder").hide(),t.closest("tr").find("td.field-placeholder .js-no-placeholder").show()),this.doesSupportRequired(e)?(this.log("Supports required; showing"),t.closest("tr").find("td.required .js-supports-required").show(),t.closest("tr").find("td.required .js-no-required").hide()):(this.log("Does not support required; hiding"),t.closest("tr").find("td.required .js-supports-required").hide(),t.closest("tr").find("td.required .js-no-required").show()),this.doesSupportRequired(e)?(this.log("Supports custom attributes; showing"),t.closest("tr").find("td.attributes .js-supports-attributes").show(),t.closest("tr").find("td.attributes .js-no-attributes").hide()):(this.log("Does not support custom attributes; hiding"),t.closest("tr").find("td.attributes .js-supports-attributes").hide(),t.closest("tr").find("td.attributes .js-no-attributes").show()),this}doesSupportBehaviour(t,e){try{return this.types.find((e=>e.slug===t))[e]}catch(t){return!1}}doesSupportOptions(t){return this.doesSupportBehaviour(t,"supports_options")}doesSupportOptionSelect(t){return this.doesSupportBehaviour(t,"supports_options_selected")}doesSupportOptionDisable(t){return this.doesSupportBehaviour(t,"supports_options_disabled")}doesSupportDefaultValue(t){return this.doesSupportBehaviour(t,"supports_default_values")}doesSupportPlaceholder(t){return this.doesSupportBehaviour(t,"supports_placeholder")}doesSupportRequired(t){return this.doesSupportBehaviour(t,"supports_required")}doesSupportCustomAttributes(t){return this.doesSupportBehaviour(t,"supports_custom_attributes")}log(){this.adminController.log(...arguments)}warn(t,e){this.adminController.warn(...arguments)}}window.NAILS.ADMIN.registerPlugin("nails/module-form-builder","FormBuilder",(function(e){return new class{constructor(t){this.adminController=t,this.init()}init(){$(".form-builder").each(((e,s)=>{let o=$(s);$(s).data("instance",new t(this.adminController,o))}))}}(e)}))}();